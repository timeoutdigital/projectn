<?php

require_once 'PHPUnit/Framework.php';
require_once dirname( __FILE__ ) . '/../../../../../test/bootstrap/unit.php';
require_once dirname( __FILE__ ) . '/../../../bootstrap.php';

/**
 * Test class for ImportUaeMovies.
 * Generated by PHPUnit on 2010-03-26 at 11:55:25.
 */
class ImportUaeMoviesTest extends PHPUnit_Framework_TestCase
{
    /**
     * @var ImportUaeMovies
     */
    protected $object;

    protected $xmlObj;

    /**
     * Sets up the fixture, for example, opens a network connection.
     * This method is called before a test is executed.
     */
    protected function setUp()
    {
        
         try {

          ProjectN_Test_Unit_Factory::createDatabases();
          Doctrine::loadData('data/fixtures');
          

        }
        catch( Exception $e )
        {
          echo $e->getMessage();
        }

        $vendorObj =  Doctrine::getTable('Vendor')->getVendorByCityAndLanguage('dubai', 'en-US');

        $this->object = new ImportUaeMovies($this->getXml(), $vendorObj );
    }

    /**
     * Tears down the fixture, for example, closes a network connection.
     * This method is called after a test is executed.
     */
    protected function tearDown()
    {
         //Close DB connection
       ProjectN_Test_Unit_Factory::destroyDatabases();
    }

    /**
     * Test the Import() function.
     */
    public function testImport()
    {
        $this->object->import();
        $movieObj = Doctrine::getTable('Movie')->findAll();
        $this->assertEquals(8, $movieObj->count(), 'Test all movies are inserted');

        $movieObj = Doctrine::getTable('Movie')->findOneById(1);
        $this->assertEquals(1, $movieObj['MovieGenres']->count(), 'Test there is at least one category there');

        $movieObj = Doctrine::getTable('Movie')->findOneById(3);
        $this->assertEquals(3, $movieObj['rating'], 'Test there is a rating');


    }


    /**
     * Test the SetRating() function.
     */
    public function testSetRating()
    {
        $movieObj = new Movie();
        $movieObj['vendor_movie_id']    =  111;
        $movieObj['name']               = "Test movie";
        $movieObj['plot']               = "The plot";
        $movieObj['review']             = "The review";
        $movieObj['url']                = "http://ere.com";
        $movieObj['Vendor']             = $this->vendorObj;

        $tagsArray=array();
        $tagsArray[] = 'G';
        $tagsArray[] = 'Arabic';
        $tagsArray[] = 'Comedy';
        $tagsArray[] = 'Horror';
        $tagsArray[] = '7 star';

        $this->object->setRating($tagsArray, $movieObj);

        $this->assertEquals(5, $movieObj['rating'], 'Testing that the rating is set and is capped at 5');
    }

    /**
     * Test the AddGenres() function.
     */
    public function testAddGenres()
    {
        
        $movieObj = new Movie();
        $movieObj['vendor_movie_id']    =  111;
        $movieObj['name']               = "Test movie";
        $movieObj['plot']               = "The plot";
        $movieObj['review']             = "The review";
        $movieObj['url']                = "http://ere.com";
        $movieObj['Vendor']             = $this->vendorObj;

        $tagsArray=array();
        $tagsArray[] = 'G';
        $tagsArray[] = 'Arabic';
        $tagsArray[] = 'Comedy';
        $tagsArray[] = 'Horror';
        $tagsArray[] = '2 star';

        $this->object->addGenres($tagsArray, $movieObj);

        $this->assertEquals(2, $movieObj['MovieGenres']->count(), 'Testing that only the two genres are inserted');

    }
//
//    /**
//     * @todo Implement testGetMovie().
//     */
//    public function testGetMovie()
//    {
//        // Remove the following lines when you implement this test.
//        $this->markTestIncomplete(
//                'This test has not been implemented yet.'
//        );
//    }


    private function getXml()
    {
        $xmlString = <<< EOF
<?xml version="1.0" encoding="UTF-8"?>
<timeout-data>
<title>TimeOutDubai.com Latest Films</title>
<category>films</category>
<films>
<film id="540">
<name><![CDATA[Kaltet Fauzia]]></name>
<landing_url><![CDATA[http://www.timeoutabudhabi.com/films/reviews/14316-kaltet-fauzia]]></landing_url>
<description><![CDATA[Arabic film]]></description>
<full_review><![CDATA[]]></full_review>
<release_date>2010-03-25</release_date>
<director><![CDATA[Magdi Ahmed Ali]]></director>
<cast><![CDATA[Ihlam Shaheen]]></cast>
<duration>115</duration>

<website><![CDATA[]]></website>
<parties>
<party>
<screen>2</screen>
<times>13:45,19:00,24:05</times>
<start_date>2010-03-25</start_date>
<cinema_id>2000</cinema_id>
</party>
<party>
<screen>5</screen>
<times>19:30,21:40,23:50</times>

<start_date>2010-03-25</start_date>
<cinema_id>2001</cinema_id>
</party>
<party>
<screen>8</screen>
<times>19:40,21:50,24:00</times>
<start_date>2010-03-25</start_date>
<cinema_id>2002</cinema_id>
</party>
</parties>
<tags><![CDATA[G,Arabic,Comedy]]></tags>

</film>
<film id="539">
<name><![CDATA[How To Train Your Dragon]]></name>
<landing_url><![CDATA[http://www.timeoutabudhabi.com/films/reviews/14190-how-to-train-your-dragon]]></landing_url>
<description><![CDATA[Early reviews of DreamWorks’ latest computer animated family film have been favourable]]></description>
<full_review><![CDATA[Early reviews of DreamWorks’ latest computer animated family film have been favourable, but we can’t shake the feeling that this will be another in a long line of failures on the studio’s part to measure up to Pixar. The trailer sets an almost painfully formulaic scene: a geeky Viking called Hiccup isn’t respected by the rest of his tribe because he’s ‘different’, but gets the chance to prove himself when he starts training to fight dragons. But then he secretly befriends a dragon, and learns they’re not so bad after all. Unlike Pixar, which continuously comes up with original one-offs (<em>WALL-E</em>, <em>The Incredibles</em>, <em>Up</em>), this is based on a children’s book and has ‘long-running but increasingly-deteriorating-in-quality franchise’ written all over it, just like former DreamWorks successes <em>Shrek</em> and <em>Madagascar</em>, the fourth and third installments of which are due this year. No doubt this will work for kids, but if it’s commitment to excellence you’re after, hold out for <em>Toy Story 3</em> (Pixar’s only – and still good – franchise so far).]]></full_review>
<release_date>2010-03-25</release_date>
<director><![CDATA[Chris Sanders, Dean DeBlois]]></director>
<cast><![CDATA[Jay Baruchel, Gerard Butler, America Ferrara, Jonah Hill, Christopher Mintz-Plasse, Craig Ferguson, Kristen Wiig, T.J. Miller]]></cast>
<duration>98</duration>
<website><![CDATA[www.howtotrainyourdragon.com]]></website>
<parties>
<party>
<screen>5</screen>

<times>10:00,12:15,14:30,16:45,19:00,21:15,23:30</times>
<start_date>2010-03-25</start_date>
<cinema_id>2000</cinema_id>
</party>
<party>
<screen>2</screen>
<times>10:00,12:00,14:00,16:00,18:00,20:00,22:00,24:00</times>
<start_date>2010-03-25</start_date>
<cinema_id>2001</cinema_id>
</party>

<party>
<screen>3</screen>
<times>10:00,12:00,14:00,16:00,18:00,20:00,22:00,24:00</times>
<start_date>2010-03-25</start_date>
<cinema_id>2002</cinema_id>
</party>
<party>
<screen>2</screen>
<times>10:00,12:00,14:00,16:00,18:00,20:00,22:00,24:00</times>
<start_date>2010-03-25</start_date>

<cinema_id>2003</cinema_id>
</party>
<party>
<screen>2</screen>
<times>10:00,12:00,14:00,16:00,18:00,20:00,22:00,24:00</times>
<start_date>2010-03-25</start_date>
<cinema_id>2004</cinema_id>
</party>
<party>
<screen>1</screen>
<times>10:00,12:00,14:00,16:00,18:00,20:00,22:00,24:00</times>

<start_date>2010-03-25</start_date>
<cinema_id>2005</cinema_id>
</party>
<party>
<screen>4</screen>
<times>10:00,12:00,14:00,16:00,18:00,20:00,22:00,24:00</times>
<start_date>2010-03-25</start_date>
<cinema_id>6273</cinema_id>
</party>
</parties>
<tags><![CDATA[G,English,Action,Adventure,Animation]]></tags>

</film>
<film id="538">
<name><![CDATA[Daybreakers]]></name>
<landing_url><![CDATA[http://www.timeoutabudhabi.com/films/reviews/14189-daybreakers]]></landing_url>
<description><![CDATA[An ambitious premise about a future world ruled by corporate vampires is explored with some intelligence]]></description>
<full_review><![CDATA[An ambitious premise about a future world ruled by corporate vampires is explored with some intelligence, sly humour and blood-splattering brio by the Spierig brothers – but is let down badly by sluggish pacing and cheap production values.<br /><br />Appalled by sleek-suited Sam Neill’s cynical control of the market in farmed human blood, renegade haematologist Ethan Hawke joins forces with the human resistance headed by the Elvis-quoting, crossbow-wielding Willem Dafoe. There’s an emotional angle too: Neill’s estranged daughter has gone Awol after refusing to be ‘turned’, while Hawke’s boneheaded brother is a gung-ho hunter of humans. The resistance is seeking a cure for vampirism, but Neill is more interested in developing a lucrative, synthetic blood substitute.<br /><br />Sadly, like the sun-fearing vampires, the film’s characters don’t get out much: for long stretches, they’re trapped in over-designed interiors spouting dull expository dialogue. <em>Daybreakers</em> is a marked improvement on the Spierigs’ 2003 debut Undead, but its pulse is decidedly erratic.]]></full_review>
<release_date>2010-03-25</release_date>
<director><![CDATA[Peter Spierig, Michael Spierig]]></director>
<cast><![CDATA[Ethan Hawke, Willem Dafoe, Claudia Karvan, Michael Dorman, Sam Neill, Vince Colosimo, Isabel Lucas]]></cast>
<duration></duration>
<website><![CDATA[www.daybreakersmovie.com]]></website>
<parties>
<party>
<screen>1</screen>
<times>10:30,12:45,15:00,17:15,19:30,21:45,24:00</times>

<start_date>2010-03-25</start_date>
<cinema_id>2000</cinema_id>
</party>
<party>
<screen>3</screen>
<times>11:00,13:10,15:20,17:30,19:40,21:50,24:00</times>
<start_date>2010-03-25</start_date>
<cinema_id>2001</cinema_id>
</party>
<party>
<screen>1</screen>

<times>11:00,13:10,15:20,17:30,19:40,21:50,24:00</times>
<start_date>2010-03-25</start_date>
<cinema_id>2002</cinema_id>
</party>
<party>
<screen>1</screen>
<times>11:00,13:10,15:20,17:30,19:40,21:50,24:00</times>
<start_date>2010-03-25</start_date>
<cinema_id>2003</cinema_id>
</party>

<party>
<screen>1</screen>
<times>11:00,13:10,15:20,17:30,19:40,21:50,24:00</times>
<start_date>2010-03-25</start_date>
<cinema_id>2004</cinema_id>
</party>
<party>
<screen>2</screen>
<times>11:00,13:10,15:20,17:30,19:40,21:50,24:00</times>
<start_date>2010-03-25</start_date>

<cinema_id>2005</cinema_id>
</party>
<party>
<screen>1</screen>
<times>11:00,13:10,15:20,17:30,19:40,21:50,24:00</times>
<start_date>2010-03-25</start_date>
<cinema_id>6273</cinema_id>
</party>
</parties>
<tags><![CDATA[18+,English,Horror,3 star]]></tags>
</film>
<film id="537">

<name><![CDATA[The Road]]></name>
<landing_url><![CDATA[http://www.timeoutabudhabi.com/films/reviews/14188-the-road]]></landing_url>
<description><![CDATA[When Cormac McCarthy’s saga of post-apocalyptic angst won the Pulitzer Prize in 2007, a big screen adaptation became inevitable]]></description>
<full_review><![CDATA[When Cormac McCarthy’s saga of post-apocalyptic angst won the Pulitzer Prize in 2007, a big screen adaptation became inevitable. Hillcoat’s film is as direct and unflinching an adaptation as one could hope for. A man (Viggo Mortensen) and a boy (Kodi Smit-McPhee) wander the American wasteland after an unnamed ecological disaster. The trees are bare, the animals dead, the few human survivors starving, desperate, often violent, occasionally monstrous. The Road is certainly the bleakest and potentially the least commercial product in recent Hollywood history. Both book and movie suffer from the same inherent weakness – they exist purely to make you miserable.<br /><br />On which level, Hillcoat’s movie is a triumph. Stunning landscape photography sets the melancholy mood, but it’s the performances that hold the film together. We expect this kind of selfless professionalism from Mortensen, but it’s the incidental characters who steal the show, notably Robert Duvall in a startling cameo which not only distils the film’s key themes into a single three-minute scene, but single-handedly lifts a potentially drab affair into something quietly impressive. Just don’t expect to walk out smiling.]]></full_review>
<release_date>2010-03-25</release_date>
<director><![CDATA[John Hillcoat]]></director>
<cast><![CDATA[Viggo Mortensen, Robert Duvall, Charlize Theron, Guy Pearce, Kodi Smit-McPhee]]></cast>
<duration>111</duration>
<website><![CDATA[www.theroad-movie.com]]></website>
<parties>
<party>
<screen>4</screen>
<times>10:00,14:30,19:15,24:15</times>

<start_date>2010-03-25</start_date>
<cinema_id>2000</cinema_id>
</party>
<party>
<screen>5</screen>
<times>10:15,12:30,14:45,17:10,19:25,21:35,23:50</times>
<start_date>2010-03-25</start_date>
<cinema_id>2002</cinema_id>
</party>
</parties>
<tags><![CDATA[PG15,English,Drama,Horror,Thriller,3 star]]></tags>

</film>
<film id="536">
<name><![CDATA[The Bounty Hunter]]></name>
<landing_url><![CDATA[http://www.timeoutabudhabi.com/films/reviews/14187-the-bounty-hunter]]></landing_url>
<description><![CDATA[Gerard Butler plays Milo Boyd, an ex-cop turned bail bondsman assigned to haul in his ex-wife Nicole (Jennifer Aniston), a hotshot reporter in deep with the law]]></description>
<full_review><![CDATA[Gerard Butler plays Milo Boyd, an ex-cop turned bail bondsman assigned to haul in his ex-wife Nicole (Jennifer Aniston), a hotshot reporter in deep with the law. The pursuit takes these bickering exes from New York to Atlantic City and back, via a series of perfunctory car chases, poorly choreographed punch-ups and excruciating romantic entanglements.<br /><br />The trouble is not so much that Butler isn’t funny – he isn’t, even slightly – but that he sucks the merest hint of humour from the entire enterprise. Even proven performers like Aniston and Christine Baranski as a sexually voracious mother-in-law are reduced to desperate mugging and hysterical arm-waving in an attempt to fill the comic vacuum their muscular co-star leaves in his wake. To be fair, the script gives them little to work with: there are maybe three decent laughs, interspersed with long stretches of interminable, would-be witty banter and one near-unwatchable comedy torture scene.<br /><br /><em>The Bounty Hunter</em> isn’t bad enough to be offensive: it’s simply lazy, trite, smug, irritating and a colossal waste of time, talent and money. There’ll be worse films released in 2010 – but not many.]]></full_review>
<release_date>2010-03-25</release_date>
<director><![CDATA[Andy Tennant]]></director>
<cast><![CDATA[Jennifer Aniston, Gerard Butler, Jason Sudeikis, Dorian Missick, Joel Marsh Garland, Christine Baranski]]></cast>
<duration>110</duration>
<website><![CDATA[www.thepursuitbegins.com]]></website>
<parties>
<party>
<screen>6</screen>

<times>10:15,12:30,14:45,17:00,19:15,21:30,23:45</times>
<start_date>2010-03-25</start_date>
<cinema_id>2000</cinema_id>
</party>
<party>
<screen>1</screen>
<times>10:00,12:25,14:45,17:05,19:25,21:45,24:10</times>
<start_date>2010-03-25</start_date>
<cinema_id>2001</cinema_id>
</party>

<party>
<screen>2</screen>
<times>10:00,12:25,14:45,17:05,19:25,21:45,24:10</times>
<start_date>2010-03-25</start_date>
<cinema_id>2002</cinema_id>
</party>
<party>
<screen>3</screen>
<times>10:00,12:25,14:45,17:05,19:25,21:45,24:10</times>
<start_date>2010-03-25</start_date>

<cinema_id>2003</cinema_id>
</party>
<party>
<screen>3</screen>
<times>10:00,12:25,14:45,17:05,19:25,21:45,24:10</times>
<start_date>2010-03-25</start_date>
<cinema_id>2004</cinema_id>
</party>
<party>
<screen>2</screen>
<times>10:00,12:25,14:45,17:05,19:25,21:45,24:10</times>

<start_date>2010-03-25</start_date>
<cinema_id>6273</cinema_id>
</party>
</parties>
<tags><![CDATA[PG15,English,Action,Comedy,1 star]]></tags>
</film>
<film id="529">
<name><![CDATA[Hush]]></name>
<landing_url><![CDATA[http://www.timeoutabudhabi.com/films/reviews/14105-hush]]></landing_url>
<description><![CDATA[Brit horror movie with Will Ash and Christine Bottomley]]></description>
<full_review><![CDATA[Employing the service stations and slip roads of the Yorkshire stretch of a rainy M1 in the UK, <em>Hush</em> sees warring young couple Zakes (Will Ash) and Beth (Christine Bottomley) spy a caged, naked woman in the back of a lorry. Beth suggests they investigate; Zakes wants to leave it to the police. But then Beth goes missing, Zakes’s phone goes dead (naturally), and he’s suspected of killing a security guard. So the ordeal begins.<br /><br />Despite some clever, surely improvised set-ups and a welcome unhistrionic central turn from Ash, this relies on one tension-destroying cliché too many and offers too few thrills to satisfy the hardened horror buff.]]></full_review>
<release_date>2010-03-18</release_date>
<director><![CDATA[Mark Tonderai]]></director>
<cast><![CDATA[William Ash, Christine Bottomley, Andreas Wisniewski, Claire Keelan, Stuart McQuarrie, Robbie Gee]]></cast>

<duration>91</duration>
<website><![CDATA[www.hushmovie.co.uk]]></website>
<parties>
<party>
<screen>8</screen>
<times>19:45,21:45,23:45</times>
<start_date>2010-03-18</start_date>
<cinema_id>2000</cinema_id>
</party>
<party>
<screen>6</screen>

<times>10:15,14:00,18:00,22:00</times>
<start_date>2010-03-25</start_date>
<cinema_id>2001</cinema_id>
</party>
<party>
<screen>3</screen>
<times>10:15,12:00,14:00,16:00,20:00,22:00,24:15</times>
<start_date>2010-03-18</start_date>
<cinema_id>2002</cinema_id>
</party>

<party>
<screen>6</screen>
<times>12:00,16:00,20:00,24:00</times>
<start_date>2010-03-25</start_date>
<cinema_id>6273</cinema_id>
</party>
</parties>
<tags><![CDATA[18+,English,Horror,Thriller,3 star]]></tags>
</film>
<film id="530">
<name><![CDATA[Five Minutes Of Heaven]]></name>
<landing_url><![CDATA[http://www.timeoutabudhabi.com/films/reviews/14103-five-minutes-of-heaven]]></landing_url>
<description><![CDATA[The cinema of Ireland’s ‘The Troubles’ has predictable motifs]]></description>

<full_review><![CDATA[The cinema of Ireland’s ‘<em>The Troubles</em>’ has predictable motifs: period-appropriate bad haircuts, rioters chucking rubble, clandestine meetings in pub back rooms. There’s initially no reason to believe that this is anything but another Celtic-pathos clone, as teenagers with ’70s shag-dos carry out an anti-Catholic assassination in the first 15 minutes.<br /><br />But after this preamble, the tone shifts. The young Protestant who pulled the trigger has grown into a haunted Liam Neeson; the boy who watched his brother die that night is now a neurotic James Nesbitt. The two are being shuttled to a TV programme where they will confront each other. From that point, the film becomes less interested in rehashing nationalistic conflicts than in the scars left by righteousness. But when violence rears its ugly head again, the effect is as anti-climactic as the movie’s title is misleading. Brief bliss is a red herring; there’s only a lifetime of pain left in such acts’ wakes.]]></full_review>
<release_date>2010-03-18</release_date>
<director><![CDATA[Oliver Hirschbiegel]]></director>
<cast><![CDATA[Liam Neeson, James Nesbitt, Anamaria Marinca]]></cast>
<duration>89</duration>
<website><![CDATA[]]></website>
<parties>
<party>
<screen>3</screen>
<times>11:15,15:15,19:15,23:15</times>
<start_date>2010-03-18</start_date>
<cinema_id>2000</cinema_id>

</party>
<party>
<screen>6</screen>
<times>12:00,16:00,20:00,24:00</times>
<start_date>2010-03-25</start_date>
<cinema_id>2001</cinema_id>
</party>
<party>
<screen>5</screen>
<times>11:30,13:30,15:30,17:40,19:40,21:50,23:55</times>
<start_date>2010-03-18</start_date>

<cinema_id>2002</cinema_id>
</party>
<party>
<screen>6</screen>
<times>14:00,18:00,22:00</times>
<start_date>2010-03-25</start_date>
<cinema_id>6273</cinema_id>
</party>
</parties>
<tags><![CDATA[PG15,English,Drama,Thriller,3 star]]></tags>
</film>
<film id="528">

<name><![CDATA[Serious Moonlight]]></name>
<landing_url><![CDATA[http://www.timeoutabudhabi.com/films/reviews/14102-serious-moonlight]]></landing_url>
<description><![CDATA[Meg Ryan and Timothy Hutton come together in this Cheryl Hine's comedy]]></description>
<full_review><![CDATA[Most spouses talk through their problems when the marriage hits a rocky patch. Occasionally, however, you’ve just got to duct-tape your husband to a toilet, according to Cheryl Hines’s anti-valentine, which pits a lawyer (Meg Ryan) against an estranged mate (Timothy Hutton). Adhered to the commode and engaging in some couples therapy, everything seems beyond repair, until a burglar (Justin Long) ties up both spouses and turns the place into a party pad.<br /><br />If you’ve seen Hines as Larry David’s wife on <em>Curb Your Enthusiasm</em>, you know she’s a deft comedian. Yet <em>Serious Moonlight</em> hasn’t enough bite or enough heart to sustain it as a female-revenge-fantasy-cum-romcom; even its faux-edgy moments seem remarkably frivolous.]]></full_review>
<release_date>2010-03-18</release_date>
<director><![CDATA[Cheryl Hines]]></director>
<cast><![CDATA[Kristen Bell, Justin Long, Meg Ryan, Timothy Hutton, Kimberlee Peterson, Andy Ostroy]]></cast>
<duration>84</duration>
<website><![CDATA[]]></website>
<parties>
<party>
<screen>3</screen>
<times>13:15,17:15,21:15</times>

<start_date>2010-03-18</start_date>
<cinema_id>2000</cinema_id>
</party>
<party>
<screen>2</screen>
<times>11:00,13:00,15:20,17:30,19:30,21:30,23:40</times>
<start_date>2010-03-18</start_date>
<cinema_id>2001</cinema_id>
</party>
<party>
<screen>2</screen>

<times>11:00,13:00,15:20,17:30,19:30,21:30,23:40</times>
<start_date>2010-03-18</start_date>
<cinema_id>2002</cinema_id>
</party>
<party>
<screen>7</screen>
<times>13:00,17:20,21:40</times>
<start_date>2010-03-25</start_date>
<cinema_id>6273</cinema_id>
</party>

<party>
<screen>4</screen>
<times>10:30,12:25,14:20,16:15,18:10,20:05,22:00,23:55</times>
<start_date>2010-03-18</start_date>
<cinema_id>6470</cinema_id>
</party>
</parties>
<tags><![CDATA[PG15,English,Comedy,Drama,2 star]]></tags>
</film>

</films>
</timeout-data>
EOF;
        return simplexml_load_string($xmlString);

    }
}
?>
