<?php

/**
 * RecordFieldOverride
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    sf_sandbox
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 6820 2009-11-30 17:27:49Z jwage $
 */
class RecordFieldOverride extends BaseRecordFieldOverride
{
  public function save( Doctrine_Connection $conn = null )
  {
    if ( !$this->exists() )
    {
      $existingOverride = $this->getTable()->findPreviousOverrideFor( $this );

      if( $existingOverride instanceof Doctrine_Record )
      {
        if( $this[ 'edited_value' ] == $existingOverride[ 'edited_value' ] )
        {
          $existingOverride[ 'is_active' ] = $this[ 'is_active' ];
          $existingOverride->save();
          return;
        }
        else
        {
          $this[ 'received_value' ] = $existingOverride[ 'received_value' ];
        }
      }

    }
    parent::save();
  }
}
