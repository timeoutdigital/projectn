<?php

/**
 * This class has been auto-generated by the Doctrine ORM Framework
 */
abstract class PluginSLLEvent extends BaseSLLEvent
{

	/**
	 * Simple function to check if Event has ended:
	 *
	 */
	public function getHasEnded()
	{
        $curTime = explode( '-', date( 'Y-m-d' ) );
        $curTime = mktime( 0, 0, 0, $curTime[1], $curTime[2], $curTime[0] );

        $endTime = explode( '-', $this->date_end );
        $endTime = mktime( 0, 0, 0, $endTime[1], $endTime[2], $endTime[0] );

        return ( $endTime < $curTime );
	}

	/**
	 * If recommended, recommended field == 1
	 *
	 * @return boolean If this event is recommended
	 */
    public function getRecommended()
    {
        return ( $this->_get( 'recommended' ) == 1 );
    }

    /**
     * If critic's Choice, recommended field == 1
     *
     * @return boolean If this event is recommended
     */
    public function getCriticsChoice()
    {
        return ( $this->_get( 'recommended' ) == 2 );
    }


    public function getFamilyFriendly()
    {
        return $this[ 'suitable_for_kids' ];
    }



    public function getAllVenues( )
    {
        $venues = $this->getTable( )
                       ->createQuery( )
                       ->select( 'v.*' )
                       ->from( 'SLLVenue v' )
                       ->innerJoin( 'v.SLLOccurrence o' )
                       ->where( 'o.event_id = ?', $this[ 'id' ] )
                       ->groupBy( 'v.id' )
                       ->execute( );

        return $venues;
    }



    public function setImageReference( $imageId )
    {
        return $this->_set( 'image_id', $imageId );
    }


    public function getUrl( )
    {
        $url = $this->_get( 'url' );

        if ( !empty( $url ) && !preg_match( '/^[^a-z]+$/i', $url ) && preg_match( '|^(https?)\:\/\/.*|i', $url ) == 0 )
            $url = "http://$url";

        return $url;
    }

}
